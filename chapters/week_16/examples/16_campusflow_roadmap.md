# 示例 6：CampusFlow 未来发展路线图

## 问题场景

Week 16 项目集市上，一个评委问："CampusFlow v1.0 不错，但 v1.1、v2.0 打算做什么？"

小北愣住了——他只想着"把作业做完"，没想过"项目还有未来"。

**产品路线图**（Product Roadmap）不是"堆砌功能"，而是"基于用户反馈，规划合理的发展路径"。

## 核心概念

**版本管理**：Semantic Versioning（SemVer）
- **MAJOR**（主版本）：不兼容的 API 变更
- **MINOR**（次版本）：向后兼容的新功能
- **PATCH**（补丁版本）：向后兼容的 bug 修复

示例：
- `v1.0.0` → `v1.0.1`：修复"取消预约"功能的 bug
- `v1.0.0` → `v1.1.0`：新增"历史记录查看"功能
- `v1.0.0` → `v2.0.0`：架构重构（从单体到微服务）

## 使用示例

下面是 CampusFlow 的完整路线图（v1.0 → v2.0）：

```markdown
# CampusFlow 产品路线图

## v1.0.0：当前状态（Week 16 发布）

### 已实现功能
- [x] 用户注册/登录（内存存储）
- [x] 会议室列表查看
- [x] 预约创建（含冲突检测）
- [x] 预约取消
- [x] REST API（10 个端点）
- [x] 前端界面（HTML + JS）
- [x] API 文档（OpenAPI）
- [x] 测试覆盖率 87%

### 已知限制
- 用户数据在内存中，重启后丢失
- 并发性能有限（SQLite 单连接）
- 没有移动端适配
- 没有提醒功能（邮件/短信）
- 没有数据导出

---

## v1.0.1：Bug 修复版（Week 17 发布）

### 目标
修复项目集市反馈的 Top 3 bug

### 改动
| Bug | 优先级 | 修复方案 |
|-----|--------|----------|
| 重复预约检测太晚 | P0 | 在表单第一页就调用 `/api/check-conflict` |
| CORS 配置太宽松 | P0 | 从 `*` 改为特定域名 |
| API 响应 > 2 秒 | P0 | 添加数据库索引 |

### 技术债修复
- [ ] API 响应时间优化（添加索引，目标 < 500ms）
- [ ] CORS 安全加固（限制允许的来源）

### 交付标准
- [ ] 所有 P0 bug 修复
- [ ] 回归测试通过
- [ ] 更新 CHANGELOG.md

---

## v1.1.0：功能增强版（Week 19 发布）

### 目标
基于项目集市反馈，新增 3 个高需求功能

### 新增功能

#### 1. 历史记录查看
**用户需求**："想找上周的预约记录，找不到"

**设计方案**：
- 新增 API：`GET /api/bookings/history?userId=123&startDate=2026-01-01&endDate=2026-01-31`
- 前端：添加"我的预约"页面，支持日期筛选
- 分页：每页 20 条，避免一次加载过多数据

**技术要点**：
- SQL 查询优化（避免 N+1 问题）
- 缓存热门用户的最近 7 天记录（可选，v1.2）

---

#### 2. 预约提醒功能
**用户需求**："经常忘约，需要提醒"

**设计方案**：
- 提醒方式：邮件（v1.1）/ 短信（v1.2，需接入第三方）
- 提醒时间：预约前 15 分钟、1 天
- 用户可配置：在用户设置中开启/关闭

**技术要点**：
- 用 `ScheduledExecutorService` 定时扫描即将开始的预约
- 邮件发送：JavaMail API
- 失败重试：如果邮件发送失败，重试 3 次

**API 设计**：
```java
POST /api/bookings/{id}/reminder
{
  "type": "email",
  "beforeMinutes": 15
}
```

---

#### 3. 数据导出（CSV）
**用户需求**："老师要做报表，需要导出数据"

**设计方案**：
- 新增 API：`GET /api/bookings/export?format=csv&month=2026-01`
- 导出字段：预约 ID、用户姓名、会议室名称、开始时间、结束时间、状态
- 权限控制：只允许导出自己的预约（管理员可导出全部）

**技术要点**：
- 用 OpenCSV 生成 CSV 文件
- 大数据量优化（> 1000 条时异步生成，发送邮件通知）

---

### 技术改进
- [ ] 引入 HikariCP（数据库连接池）
- [ ] 用 Testcontainers 做集成测试（真数据库测试）
- [ ] 添加 Prometheus 监控指标（API 响应时间、错误率）

### 交付标准
- [ ] 3 个新功能上线
- [ ] API 文档更新
- [ ] 测试覆盖率保持 85%+

---

## v1.2.0：体验优化版（Week 22 发布）

### 目标
提升用户体验和性能

### 优化项目

#### 1. 移动端适配（PWA）
**用户需求**："手机上用起来不方便"

**设计方案**：
- 用响应式设计（Bootstrap CSS）
- 添加 PWA 支持（Service Worker + Manifest）
- 支持离线访问（缓存静态资源）

**技术要点**：
- Viewport 配置：`<meta name="viewport" content="width=device-width, initial-scale=1.0">`
- Service Worker：缓存 API 响应（只缓存 GET 请求）
- 添加到主屏幕：Web App Manifest

---

#### 2. 搜索功能优化
**用户需求**："会议室太多，找不到想要的"

**设计方案**：
- 支持按名称、容量、位置搜索
- 实时搜索（输入时即时显示结果）
- 高亮匹配关键字

**技术要点**：
- 前端：用 debounce 优化（避免每次输入都请求）
- 后端：用 `LIKE %keyword%` 或全文索引（SQLite FTS5）

---

#### 3. 性能优化
**目标**：API 响应时间从平均 500ms 降到 200ms

**优化方案**：
| 优化项 | 当前 | 目标 | 方法 |
|--------|------|------|------|
| 数据库查询 | 300ms | 100ms | 添加索引、JOIN 优化 |
| 序列化 | 100ms | 50ms | 用 Jackson 替代手动拼接 |
| 网络延迟 | 100ms | 50ms | 启用 GZIP 压缩 |

---

### 技术改进
- [ ] 引入 Redis 缓存（热门会议室列表）
- [ ] 用 JaCoCo 做性能分析
- [ ] 配置 CDN 加速（前端资源）

### 交付标准
- [ ] 移动端用户体验评分 > 80（Lighthouse）
- [ ] API 平均响应时间 < 200ms
- [ ] 搜索功能支持 1000+ 会议室

---

## v2.0.0：架构重构版（Week 26 发布）

### 目标
从单体应用迁移到微服务架构，支持更大规模

### 架构变化

#### v1.x 架构（单体）
```
┌─────────────────────────────────┐
│         Javalin Server          │
├─────────────────────────────────┤
│  ┌─────────┐  ┌──────────────┐  │
│  │  前端   │  │  REST API    │  │
│  └─────────┘  └──────────────┘  │
│       └────────────┐            │
│  ┌────────────────▼──────────┐  │
│  │      Service Layer        │  │
│  └───────────────────────────┘  │
│       └────────────┐            │
│  ┌────────────────▼──────────┐  │
│  │    Repository Layer       │  │
│  └───────────────────────────┘  │
│       └────────────┐            │
│  ┌────────────────▼──────────┐  │
│  │       SQLite DB            │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
```

#### v2.0 架构（微服务）
```
                    ┌─────────────┐
                    │   前端 (PWA) │
                    └──────┬──────┘
                           │
                    ┌──────▼──────┐
                    │  API Gateway │
                    │   (Nginx)   │
                    └──────┬──────┘
           ┌───────────────┼───────────────┐
           │               │               │
    ┌──────▼──────┐ ┌─────▼─────┐ ┌──────▼──────┐
    │ 用户服务     │ │ 预约服务   │ │ 会议室服务  │
    │  (Spring)   │ │ (Spring)  │ │  (Spring)  │
    └──────┬──────┘ └─────┬─────┘ └──────┬──────┘
           │               │               │
    ┌──────▼──────┐ ┌─────▼─────┐ ┌──────▼──────┐
    │   MySQL     │ │   MySQL   │ │   MySQL     │
    │  (用户数据)  │ │ (预约数据) │ │ (会议室数据) │
    └─────────────┘ └───────────┘ └─────────────┘

           │               │               │
    ┌──────▼──────┐ ┌─────▼─────┐ ┌──────▼──────┐
    │   Redis     │ │  RabbitMQ │ │   Redis     │
    │ (缓存 Session)│ (异步消息) │  (缓存列表)  │
    └─────────────┘ └───────────┘ └─────────────┘
```

### 新增功能

#### 1. 团队会议室
**用户需求**："我们社团内部也要预约"

**设计方案**：
- 新增"团队"概念：Team + TeamMember
- 团队管理员可以创建"团队预约"
- 团队成员可以查看团队所有预约

**API 设计**：
```
POST /api/teams
GET /api/teams/{teamId}/bookings
POST /api/teams/{teamId}/bookings
```

---

#### 2. 预约审批流程
**用户需求**："大型会议室需要管理员审批"

**设计方案**：
- 引入"审批状态"：PENDING / APPROVED / REJECTED
- 管理员后台：审批/拒绝预约申请
- 通知机制：审批结果通过邮件通知

**API 设计**：
```
POST /api/bookings/{id}/approve
POST /api/bookings/{id}/reject
```

---

#### 3. 数据分析仪表盘
**用户需求**："老师要看会议室使用率"

**设计方案**：
- 新增 `/admin/dashboard` 页面
- 图表展示：
  - 每周预约量趋势图
  - 会议室使用率排行榜
  - 用户活跃度统计

**技术要点**：
- 用 ECharts 或 Chart.js 绘制图表
- 数据聚合：用 SQL 的 `GROUP BY` + `COUNT`
- 缓存：仪表盘数据每 10 分钟刷新一次

---

### 技术栈升级

| 组件 | v1.x | v2.0 |
|------|------|------|
| Web 框架 | Javalin | Spring Boot |
| 数据库 | SQLite | MySQL |
| 缓存 | 无 | Redis |
| 消息队列 | 无 | RabbitMQ |
| 服务发现 | 无 | Consul |
| API 网关 | 无 | Nginx |
| 监控 | 无 | Prometheus + Grafana |

### 技术债偿还
- [ ] 从 SQLite 迁移到 MySQL（解决并发问题）
- [ ] 从 Javalin 迁移到 Spring Boot（更好的生态）
- [ ] 引入 Docker 容器化部署
- [ ] 配置 CI/CD（GitHub Actions）

### 交付标准
- [ ] 支持 10,000+ 并发用户
- [ ] 服务可用性 > 99.5%
- [ ] API 响应时间 < 100ms（P95）

---

## v3.0.0：SaaS 化（Week 36+ 发布）

### 目标
支持多租户，推广到其他学校

### 新增功能

#### 1. 多租户支持
**设计方案**：
- 每个学校一个租户（Tenant）
- 数据隔离：每个租户独立数据库
- 子域名：`school1.campusflow.com`、`school2.campusflow.com`

**技术要点**：
- TenantContext：从请求中提取租户 ID
- 数据源路由：根据租户 ID 选择数据库
- 计费：按租户收费（Freemium 模式）

---

#### 2. 自动排期算法
**用户需求**："AI 帮我推荐最佳时段"

**设计方案**：
- 输入：参会人数、时间段、偏好（靠近窗户/有投影仪）
- 输出：推荐 3 个最佳会议室
- 算法：基于历史数据的协同过滤

**技术要点**：
- 机器学习：用 scikit-learn 训练推荐模型
- 特征工程：时间、参会人数、历史选择
- A/B 测试：对比推荐算法的效果

---

#### 3. 小程序版本
**用户需求**："能不能做成微信小程序？"

**设计方案**：
- 用 uni-app 跨平台开发（支持微信、支付宝小程序）
- 复用现有 REST API
- 支持微信登录、微信支付（高级功能）

---

### 商业化计划

| 版本 | 功能 | 定价 |
|------|------|------|
| Free | 基础预约、最多 50 会议室 | 免费 |
| Pro | 团队预约、数据导出、客服支持 | ¥999/月 |
| Enterprise | 多租户、定制开发、私有部署 | 联系销售 |

---

## 开源计划

### v1.1 开源准备（Week 18）
- [ ] 清理敏感信息（密码、API Key）
- [ ] 添加 LICENSE（MIT）
- [ ] 写 CONTRIBUTING.md（贡献指南）
- [ ] 写 README（英文版）
- [ ] 发布到 GitHub

### v2.0 社区建设（Week 28）
- [ ] 处理第一个外部 PR
- [ ] 回复 GitHub Issues
- [ ] 发布 Roadmap（公开版本计划）
- [ ] 建立 Discord/Slack 社区

### 长期目标
- 1000+ GitHub Stars
- 10+ 外部贡献者
- 被 5+ 所学校使用

---

## 发布计划

### v1.0.1（Week 17）
- **时间**：Week 17 周五
- **方式**：GitHub Release + Git Tag
- **通知**：项目集市邮件群发

### v1.1.0（Week 19）
- **时间**：Week 19 周五
- **方式**：GitHub Release + 更新文档
- **通知**：技术博客"CampusFlow v1.1 发布"

### v1.2.0（Week 22）
- **时间**：Week 22 周五
- **方式**：GitHub Release + 演示视频
- **通知**：B 站演示视频 + 技术社区推广

### v2.0.0（Week 26）
- **时间**：Week 26 周五
- **方式**：GitHub Release + 技术分享会
- **通知**：QCon/ArchSummit 提交 CFP（演讲提案）

---

## 成功指标

### v1.x 阶段
| 指标 | v1.0 | v1.1 | v1.2 |
|------|------|------|------|
| 用户数 | 50 | 200 | 500 |
| 预约数/周 | 200 | 1000 | 3000 |
| Bug 数 | 15 | 5 | 2 |
| API 响应时间 | 500ms | 300ms | 200ms |

### v2.0 阶段
| 指标 | 目标 |
|------|------|
| 并发用户 | 10,000+ |
| 服务可用性 | > 99.5% |
| API 响应时间 | < 100ms (P95) |
| GitHub Stars | 500+ |

---

## 技术债务清单

| ID | 描述 | 优先级 | 计划版本 |
|----|------|--------|----------|
| DEBT-001 | 用户数据在内存中 | P0 | v1.1 |
| DEBT-002 | 没有数据库连接池 | P1 | v1.1 |
| DEBT-003 | 测试环境用 SQLite，生产用 MySQL | P1 | v1.1 |
| DEBT-004 | 前端代码没有审查 | P2 | v1.2 |
| DEBT-005 | 没有监控和告警 | P1 | v2.0 |
| DEBT-006 | 没有自动化部署 | P1 | v2.0 |

---

## 附录：版本号命名规范

遵循 Semantic Versioning 2.0.0：

```
MAJOR.MINOR.PATCH

示例：
v1.0.0 → v1.0.1（修复 bug）
v1.0.0 → v1.1.0（新增功能）
v1.0.0 → v2.0.0（不兼容的变更）
```

**规则**：
1. PATCH 版本：bug 修复，向后兼容
2. MINOR 版本：新增功能，向后兼容
3. MAJOR 版本：不兼容的 API 变更

**示例**：
- ❌ 错误：v1.0 → v1.1（删除了 `/api/bookings` 端点）
- ✅ 正确：v1.0 → v2.0（删除了 `/api/bookings` 端点）

---

## 相关术语

- **回顾桥**：
  - Week 14 的 Semantic Versioning → 版本号命名规范
  - Week 16 的项目集市反馈 → v1.0.1 修复计划
  - Week 02 的 ADR-001 → v2.0 架构重构

- **工程实践**：
  - Feature Branch（Week 04）→ Git Flow 发布策略
  - 质量门禁（Week 11）→ 版本发布标准
  - CI/CD（Try, Week 17）→ 自动化发布流程
