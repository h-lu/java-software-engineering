# Week 11 评分标准：质量门禁与静态分析

## 总分：100 分（基础 100 分 + 进阶 20 分）

---

## 评分维度

| 维度 | 分值 | 评分标准 | 验证方式 |
|------|------|---------|---------|
| **静态分析配置** | 20 | SpotBugs 配置正确，成功生成报告 | 检查 pom.xml + spotbugs_report.txt |
| **问题修复** | 25 | 修复至少 3 个高/中优先级问题 | 检查 fixes.md + 代码 |
| **覆盖率配置** | 15 | JaCoCo 配置正确，生成覆盖率报告 | 检查 pom.xml + jacoco_screenshot.png |
| **覆盖率提升** | 20 | 补充测试，覆盖率达到 75%+ | 运行测试验证 + new_tests.md |
| **技术债管理** | 20 | 技术债 Backlog 完整，优先级合理 | 检查 TECHNICAL_DEBT.md |

---

## 详细评分标准

### 1. 静态分析配置（20 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 18-20 | SpotBugs 插件配置正确（版本、groupId/artifactId、executions），成功运行并生成完整报告，报告内容可读 |
| 良好 | 15-17 | 配置基本正确，成功运行报告，报告完整但有 minor 问题（如未指定版本） |
| 合格 | 12-14 | 配置有尝试，能运行但报告不完整（如缺少 executions） |
| 不合格 | 0-11 | 配置错误导致无法运行 |

**检查要点**：
- [ ] pom.xml 包含 spotbugs-maven-plugin（5 分）
- [ ] 版本号正确（4.9.8.2 或相近版本）（3 分）
- [ ] executions 配置包含 check goal（5 分）
- [ ] `mvn spotbugs:check` 成功运行（4 分）
- [ ] spotbugs_report.txt 包含扫描结果（3 分）

**常见配置错误**：
- 缺少 `<executions>` 导致绑定失败
- 版本号过低或不存在
- 缺少 `<goal>check</goal>`

---

### 2. 问题修复（25 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 22-25 | 修复 3+ 个高/中优先级问题，修复方案正确，注释清晰，重新验证问题已解决，fixes.md 详细 |
| 良好 | 17-21 | 修复 3 个问题，修复正确，有注释，重新验证通过，fixes.md 完整 |
| 合格 | 12-16 | 修复 2 个问题，修复基本正确，重新验证通过，fixes.md 基本完整 |
| 不合格 | 0-11 | 修复少于 2 个问题或修复无效 |

**问题类型权重**：
- 高优先级问题（空指针、资源泄漏）：每个 6 分
- 中优先级问题（性能、未使用字段）：每个 4 分
- 低优先级问题（代码风格）：每个 2 分

**单个修复评分标准**（每个问题 5 分左右）：
- [ ] 修复方案正确有效（3 分）
- [ ] 添加注释说明修复理由（1 分）
- [ ] 重新验证问题已解决（1 分）

**fixes.md 检查要点**：
- [ ] 包含至少 3 个问题（5 分）
- [ ] 每个问题包含：类型、位置、描述、修复方案、验证结果（10 分）
- [ ] 修复前后代码对比清晰（5 分）

**常见修复错误**：
- 修复不完整（如只加了 null 检查但没处理异常）
- 修复引入新问题
- 注释缺失或模糊

---

### 3. 覆盖率配置（15 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 13-15 | JaCoCo 插件配置正确（版本、executions），成功生成 HTML 报告，截图清晰，coverage_analysis.md 分析详细 |
| 良好 | 10-12 | 配置基本正确，报告生成成功，分析完整 |
| 合格 | 7-9 | 配置有尝试，能生成报告但分析较简单 |
| 不合格 | 0-6 | 配置错误无法生成报告 |

**检查要点**：
- [ ] pom.xml 包含 jacoco-maven-plugin（5 分）
- [ ] 版本号正确（0.8.15 或相近版本）（2 分）
- [ ] executions 配置包含 prepare-agent 和 report goal（4 分）
- [ ] `mvn test jacoco:report` 成功运行（2 分）
- [ ] jacoco_screenshot.png 显示覆盖率数字（2 分）

**coverage_analysis.md 检查要点**：
- [ ] 包含当前行覆盖率和分支覆盖率（3 分）
- [ ] 列出覆盖率最低的 3 个类（4 分）
- [ ] 包含未覆盖代码示例（3 分）

---

### 4. 覆盖率提升（20 分）

| 等级 | 分值 | 标准 |
| 覆盖率 | 分值 | 标准 |
|------|------|------|------|---------|------|
| 优秀 | 18-20 | 覆盖率达到 80%+ | 75-79% | 16-17 | 覆盖率达到 75-79% |
| 良好 | 15-17 | 补充 3+ 测试，覆盖率 70-74% | 70-74% | 13-15 | 补充 3 测试，覆盖率 70-74% |
| 合格 | 12-14 | 补充 2 测试，覆盖率 65-69% | 65-69% | 10-12 | 补充 2 测试，覆盖率 65-69% |
| 不合格 | 0-11 | 测试不足或覆盖率低于 65% | <65% | 0-9 | 覆盖率低于 65% |

**补充测试评分**（12 分）：
- [ ] 至少补充 3 个测试用例（6 分，每个 2 分）
- [ ] 每个测试对应红色代码块（3 分）
- [ ] 测试有效（运行通过）（3 分）

**new_tests.md 检查要点**：
- [ ] 列出所有新增测试方法（3 分）
- [ ] 每个测试说明对应未覆盖代码位置（3 分）
- [ ] 每个测试说明测试目的（2 分）

**常见测试遗漏**：
- 只测试正常流程，遗漏异常分支
- 未测试 null 检查分支
- 未测试枚举的所有状态

---

### 5. 技术债管理（20 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 18-20 | 技术债 Backlog 包含 12+ 项，优先级分类合理，预估时间准确，修复计划具体 |
| 良好 | 15-17 | 包含 10-11 项，优先级合理，预估和计划基本准确 |
| 合格 | 12-14 | 包含 8-9 项，优先级基本合理，有预估和计划 |
| 不合格 | 0-11 | 少于 8 项或优先级混乱 |

**技术债数量检查**：
- [ ] 包含至少 10 个技术债项（8 分）
  - 超过 15 个：+2 分
  - 10-15 个：8 分
  - 8-9 个：5 分
  - 少于 8 个：0 分

**优先级合理性**（6 分）：
- [ ] P0（高影响）问题标注正确（2 分）
- [ ] P1（质量基线）问题标注正确（2 分）
- [ ] P2/P3 分配合理（2 分）

**预估和计划**（6 分）：
- [ ] 每项都有预估修复时间（3 分）
- [ ] 修复计划符合优先级逻辑（3 分）

**常见优先级错误**：
- 将低影响问题标为 P0
- 将安全/核心问题标为 P2/P3
- 所有问题都标为 P1（无区分）

---

## 进阶作业评分（+20 分）

### 进阶 1：质量门禁配置（+10 分）

| 项目 | 分值 | 评分标准 |
|------|------|---------|
| 配置完整性 | 5 | quality-gate.json 包含 SpotBugs 和 JaCoCo 规则 |
| 阈值合理性 | 3 | 阈值设计合理（如覆盖率 70% 警告、60% 阻断） |
| 设计说明 | 2 | quality-gate-explanation.md 解释清晰 |

**检查要点**：
- [ ] 至少包含 2 条 SpotBugs 规则（2 分）
- [ ] 至少包含 2 条 JaCoCo 规则（2 分）
- [ ] 包含 block/warn 动作定义（1 分）
- [ ] 阈值符合工程实用主义（3 分）
- [ ] 设计说明有理由支撑（2 分）

---

### 进阶 2：CI 配置（+10 分）

| 项目 | 分值 | 评分标准 |
|------|------|---------|
| CI 配置正确 | 6 | workflow 文件语法正确，包含质量检查步骤 |
| CI 跑通 | 4 | 提交 PR 后 CI 成功运行，有截图证明 |

**检查要点**：
- [ ] workflow 文件存在且格式正确（3 分）
- [ ] 包含 SpotBugs 检查步骤（2 分）
- [ ] 包含 JaCoCo 覆盖率检查步骤（2 分）
- [ ] CI 运行成功且有截图（3 分）

---

## 等级划分

| 等级 | 分数范围 | 描述 |
|------|---------|------|
| **A** | 90-100 | 静态分析配置优秀，修复 3+ 问题，覆盖率 75%+，技术债管理完善，文档清晰 |
| **B** | 80-89 | 配置正确，修复 3 问题，覆盖率 70-74%，技术债管理基本完善 |
| **C** | 70-79 | 配置基本正确，修复 2 问题，覆盖率 65-69%，技术债管理完整 |
| **D** | 60-69 | 配置有尝试，修复 1-2 问题，覆盖率 60-64%，技术债管理基本完整 |
| **F** | <60 | 未完成或严重不符合要求 |

---

## 迟交政策

| 迟交时间 | 扣分 |
|---------|------|
| 24 小时内 | -10% |
| 48 小时内 | -20% |
| 超过 48 小时 | 按 0 分计 |

---

## 学术诚信

- **允许**：使用 AI 辅助配置工具、参考公开文档、使用 IDE 提示
- **禁止**：
  - 复制其他同学的 fixes.md 或 TECHNICAL_DEBT.md
  - 编造虚假的覆盖率数据
  - 修复代码后声称是 AI 生成的（需标注 AI 使用）

**AI 使用透明化**：如果使用 AI 辅助，需在 AI_LOG.md 中记录使用的 Prompt 和 AI 输出。

---

## 评分检查清单（助教使用）

### 文件完整性检查
- [ ] pom.xml 存在且包含 SpotBugs 插件
- [ ] pom.xml 存在且包含 JaCoCo 插件
- [ ] spotbugs_report.txt 存在
- [ ] fixes.md 存在且包含至少 3 个问题
- [ ] jacoco_screenshot.png 存在
- [ ] coverage_analysis.md 存在
- [ ] new_tests.md 存在（或代码中有新增测试）
- [ ] TECHNICAL_DEBT.md 存在且包含至少 10 项

### 功能验证
- [ ] `mvn spotbugs:check` 成功运行
- [ ] `mvn test jacoco:report` 成功运行
- [ ] 覆盖率达到 75%+（或 65-74% 视分数而定）
- [ ] 测试都能通过（`mvn test`）

### 代码审查
- [ ] 修复的代码包含注释
- [ ] 修复后的代码未引入新问题
- [ ] 新增测试有效（测试异常/边界情况）

---

## 反馈模板

### 优秀作业反馈示例
```
总分：94/100（A）

亮点：
- SpotBugs 和 JaCoCo 配置完美，版本号、executions 都正确
- 修复了 4 个高优先级问题，包括空指针和资源泄漏，修复方案专业
- 覆盖率从 68% 提升到 82%，补充的测试涵盖异常分支和边界条件
- 技术债 Backlog 包含 15 项，优先级分类清晰，修复计划具体

建议：
- 可以考虑为 CI 配置添加邮件通知（质量门禁阻断时自动发邮件）
- 技术债中 P3 项目可以考虑在未来 Sprint 中处理，避免累积过多
```

### 需改进作业反馈示例
```
总分：65/100（D）

问题：
- pom.xml 配置缺少 executions，SpotBugs 未绑定到 test 阶段（-5 分）
- 只修复了 2 个中优先级问题，遗漏了明显的空指针风险（-10 分）
- 覆盖率只有 66%，未达到 75% 目标（-8 分）
- 技术债只有 8 项，且优先级混乱（将低影响问题标为 P0）（-12 分）

改进建议：
1. 重新阅读 Week 11 第 2、3 节，理解插件配置的 executions 作用
2. 运行 SpotBugs，优先修复高优先级问题（红色/橙色）
3. 根据 JaCoCo 报告的红色代码补充测试，特别是异常分支
4. 重新审视技术债优先级：P0 是影响安全/核心功能的，代码风格不应是 P0
```

---

## 验证命令（助教使用）

```bash
# 验证 SpotBugs 配置
cd /path/to/week_11_submission
mvn spotbugs:check

# 验证测试和覆盖率
mvn test jacoco:report

# 检查覆盖率数字
cat target/site/jacoco/index.html | grep -o 'Total[^%]*%' | head -1

# 验证所有测试通过
mvn test
```
