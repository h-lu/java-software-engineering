# Week 06 作业评分标准

**总分**：100 分（基础 40 + 进阶 30 + 挑战 20 + AI 练习 10）

**评分原则**：
- 代码正确性：能否正确处理各种异常情况
- 防御性思维：是否考虑了边界情况
- 代码风格：是否遵循 PEP 8，是否用裸的 `except:` 掩盖问题
- 错误消息：是否清晰友好（告诉用户"出了什么错、为什么、怎么修复"）

---

## 基础作业（40 分）

### 题 1：修复崩溃的除法器（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 捕获特定异常 | 5 分 | 捕获 `ValueError` 和 `ZeroDivisionError`，各 2.5 分 |
| 区分错误类型 | 3 分 | 为每种异常给出**不同的**错误提示 |
| 程序不崩溃 | 2 分 | 任何输入都不会让程序崩溃 |

**扣分项**：
- 用裸的 `except:` 捕获所有异常：-5 分
- 没有区分不同异常类型：-3 分
- 错误消息不清晰（如只写"错误"）：-2 分

**测试用例**：
```python
# 测试 1：正常输入
输入：10, 2
预期输出：结果：5.0

# 测试 2：除以零
输入：10, 0
预期输出：错误：分母不能为零

# 测试 3：非数字输入
输入：abc, 2
预期输出：错误：请输入数字，不要输入文字
```

---

### 题 2：访问字典不崩溃（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 捕获 KeyError | 5 分 | 正确使用 `except KeyError:` |
| 友好错误提示 | 3 分 | 找不到学生时给出清晰提示 |
| 程序不崩溃 | 2 分 | 任何输入都不会崩溃 |

**扣分项**：
- 用裸的 `except:` 捕获所有异常：-5 分
- 用 LBYL 风格而不是 EAFP：不扣分，但失去练习 EAFP 的机会
- 没有提示：-3 分

**测试用例**：
```python
# 测试 1：存在的学生
输入：小北
预期输出：小北 的分数：85

# 测试 2：不存在的学生
输入：张三
预期输出：错误：找不到这个学生
```

---

### 题 3：文件读取不崩溃（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 捕获 FileNotFoundError | 5 分 | 正确使用 `except FileNotFoundError:` |
| 友好错误提示 | 3 分 | 文件不存在时给出清晰提示 |
| 程序不崩溃 | 2 分 | 任何文件名都不会崩溃 |

**扣分项**：
- 用裸的 `except:` 捕获所有异常：-5 分
- 用 LBYL 风格（`os.path.exists`）：不扣分，但失去练习 EAFP 的机会
- 没有提示：-3 分

**测试用例**：
```python
# 测试 1：存在的文件
输入：data.txt（假设存在）
预期输出：<文件内容>

# 测试 2：不存在的文件
输入：不存在的文件.txt
预期输出：错误：文件不存在
```

---

### 题 4：理解 else 和 finally（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 问题 1 答对 | 3 分 | 理解 `else` 在"没出错时执行"（答"会"） |
| 问题 2 答对 | 3 分 | 理解 `finally` 在"无论是否出错都执行"（答"会"） |
| 问题 3 答对 | 4 分 | 理解 `finally` 会在 `return` 之前执行（答"会"） |

**评分标准**：
- 每题答对给满分，答错不给分
- 在注释中写"会"或"不会"即可

**答案**：
- 问题 1：会（没有抛出异常）
- 问题 2：会（`finally` 总是执行）
- 问题 3：会（`finally` 会在 `return` 之前执行）

---

## 进阶作业（30 分）

### 题 5：设计输入校验函数（15 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 使用 while 循环重试 | 4 分 | 用 `while True` 让用户重试 |
| LBYL 风格验证 | 5 分 | 用 `if` 检查（`isdigit()`、`> 0`），不是 `try/except` |
| 清晰的错误提示 | 3 分 | 非数字和 `<= 0` 有不同提示 |
| 正确返回结果 | 3 分 | 输入正确时 `return` 整数 |

**扣分项**：
- 忘记 `return` 导致无限循环：-5 分
- 用 `try/except` 而不是 LBYL：不扣分，但本题要求练习 LBYL
- 错误消息不清晰：-3 分
- 没有验证 `> 0`：-3 分

**测试用例**：
```python
# 测试 1：非数字输入
输入：abc
预期输出：错误：请输入一个正整数
预期行为：继续循环，重新提示输入

# 测试 2：非正整数
输入：-5
预期输出：错误：请输入大于 0 的整数
预期行为：继续循环，重新提示输入

# 测试 3：正确输入
输入：10
预期输出：（无错误消息）
预期返回值：10
预期行为：退出循环，返回 10
```

---

### 题 6：用 raise 上报错误（15 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 调用 get_positive_integer | 3 分 | 复用题 5 的函数 |
| 额外校验年龄范围 | 4 分 | 检查年龄是否在 `[min_age, max_age]` 范围内 |
| 用 raise 而不是 print | 5 分 | **核心考点**，用 `raise ValueError` 上报错误 |
| 清晰的错误消息 | 3 分 | 错误消息包含具体范围信息 |

**扣分项**：
- 用 `print` 而不是 `raise`：-10 分（这是核心考点）
- 错误消息不清晰（如只写"error"）：-5 分
- 没有调用 `get_positive_integer`：-5 分
- 没有校验年龄范围：-4 分

**测试用例**：
```python
# 测试 1：年龄太小（< 18）
输入：15
预期抛出：ValueError("年龄必须大于等于 18")

# 测试 2：年龄太大（> 120）
输入：150
预期抛出：ValueError("年龄超出合理范围（最大 120）")

# 测试 3：年龄正确
输入：25
预期返回值：25
预期行为：不抛出异常

# 测试 4：调用者捕获异常
try:
    age = get_age(min_age=18, max_age=120)
    print(f"你的年龄：{age}")
except ValueError as e:
    print(f"输入错误：{e}")
预期输出（输入 15）：输入错误：年龄必须大于等于 18
```

**思考题答案**：
- 用 `raise` 而不是 `print` 的原因：`print` 不会让程序停下来，调用者无法知道"成功还是失败"；`raise` 会把错误"上报"给调用者，让调用者决定怎么处理（比如重试、记录日志、给用户提示等）。

---

## 挑战作业（20 分）

### 题 7：带重试次数限制的输入函数（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 使用 for 循环限制次数 | 3 分 | 用 `for attempt in range(max_attempts)` |
| 计算剩余次数 | 2 分 | 用 `max_attempts - attempt - 1` 计算并提示 |
| 重试用完抛出异常 | 3 分 | 用完次数后 `raise ValueError` |
| 继承题 5 的校验逻辑 | 2 分 | 复用 LBYL 验证逻辑 |

**扣分项**：
- 用 `while` 而不是 `for`：-3 分（本题要求练习 `for`）
- 没有提示剩余次数：-2 分
- 重试用完没有抛出异常：-3 分

**测试用例**：
```python
# 测试 1：重试 3 次后失败
输入：abc, -5, xyz
预期输出：
错误：请输入一个正整数（剩余尝试次数：2）
错误：请输入大于 0 的整数（剩余尝试次数：1）
错误：请输入一个正整数（剩余尝试次数：0）
预期抛出：ValueError("输入错误次数过多，超过 3 次")

# 测试 2：第 2 次成功
输入：abc, 10
预期输出：
错误：请输入一个正整数（剩余尝试次数：2）
预期返回值：10
```

---

### 题 8：健壮的菜单选择（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| EAFP 风格捕获异常 | 3 分 | 用 `try/except ValueError` 捕获 `int()` 失败 |
| 验证输入范围 | 3 分 | 检查输入是否在 `[min_choice, max_choice]` 范围内 |
| while 循环重试 | 2 分 | 用 `while True` 让用户重试 |
| 清晰的错误提示 | 2 分 | 非数字和超出范围有不同提示 |

**扣分项**：
- 用 LBYL 而不是 EAFP：不扣分，但本题要求练习 EAFP
- 没有验证范围：-3 分
- 没有重试：-2 分
- 错误消息不清晰：-2 分

**测试用例**：
```python
# 测试 1：非数字输入
输入：abc
预期输出：错误：请输入数字，不要输入文字
预期行为：继续循环

# 测试 2：超出范围（太小）
输入：0
预期输出：错误：请输入 1 到 5 之间的数字
预期行为：继续循环

# 测试 3：超出范围（太大）
输入：6
预期输出：错误：请输入 1 到 5 之间的数字
预期行为：继续循环

# 测试 4：正确输入
输入：3
预期返回值：3
预期行为：退出循环
```

---

## AI 协作练习（10 分，可选）

### 审查 AI 生成的异常处理代码

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 发现至少 3 个问题 | 5 分 | 每个问题 1-2 分，看问题的重要性和描述清晰度 |
| 修复后的代码能通过测试 | 3 分 | 修复后的代码解决了所有发现的问题 |
| 测试用例设计合理 | 2 分 | 至少 3 个测试用例，覆盖发现的问题 |

**典型问题清单**（供参考）：

1. **用裸的 `except:` 捕获所有异常**（-2 分如果没发现）
   - 为什么不好：会掩盖真正的 bug，用户不知道"为什么出错"
   - 如何修复：捕获特定异常（`ValueError` 和 `ZeroDivisionError`）

2. **错误消息不清晰**（-1 分如果没发现）
   - 为什么不好："出错了！"没有告诉用户原因
   - 如何修复：为每种异常给出不同的错误提示

3. **缺少输入验证/重试**（-1 分如果没发现）
   - 为什么不好：出错后程序直接结束，用户体验差
   - 如何修复：添加 `while` 循环让用户重试

4. **没有处理边界情况**（-1 分如果没发现）
   - 为什么不好：分子为 0、负数等情况没考虑
   - 如何修复：添加额外的输入验证

**评分标准**：
- **优秀（9-10 分）**：发现 4+ 个问题，修复后的代码完善，测试用例覆盖所有边界情况
- **良好（7-8 分）**：发现 3 个问题，修复后的代码能通过基本测试
- **合格（5-6 分）**：发现 2-3 个问题，修复后的代码部分正确
- **需改进（< 5 分）**：发现的问题少于 2 个，或修复后的代码仍有明显问题

---

## PyHelper 实践（必做，计入进阶作业）

**总分**：40 分

### 菜单选择不崩溃（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 实现 get_choice 函数 | 3 分 | 函数签名正确，使用 `try/except` |
| 捕获 ValueError | 3 分 | 正确捕获非数字输入 |
| 验证输入范围 | 2 分 | 检查输入是否在 `[min_choice, max_choice]` 范围内 |
| while 循环重试 | 2 分 | 用 `while True` 让用户重试 |

**测试方法**：
```python
# 运行 PyHelper，在菜单选择时输入 "abc"
预期行为：提示"请输入数字"并重新显示菜单，不崩溃

# 输入 "0" 或 "6"（超出范围）
预期行为：提示"请输入 X 到 Y 之间的数字"并重新显示菜单，不崩溃
```

---

### 日期输入不崩溃（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 实现 get_date 函数 | 3 分 | 函数签名正确 |
| 校验日期格式 | 3 分 | 检查格式是否为 `XX-XX`（长度、分隔符） |
| 校验日期是否为数字 | 2 分 | 用 `isdigit()` 检查 |
| while 循环重试 | 2 分 | 用 `while True` 让用户重试 |

**测试方法**：
```python
# 运行 PyHelper，选择"添加学习记录"，日期输入 "hello"
预期行为：提示"日期格式不对"并重新提示输入，不崩溃

# 日期输入 "02-30"（格式对但日期可能不存在）
预期行为：接受（本题不要求验证日期的真实性）
```

---

### 心情选择不崩溃（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 改进 get_mood 函数 | 3 分 | 使用 `try/except ValueError` |
| 捕获非数字输入 | 3 分 | 正确捕获 `int()` 失败 |
| 输入无效时给默认值 | 2 分 | 不崩溃，返回默认值（如 "2"） |
| 友好提示 | 2 分 | 提示"输入无效，默认为X" |

**测试方法**：
```python
# 运行 PyHelper，选择"获取学习建议"，心情输入 "xyz"
预期行为：提示"输入无效，默认为一般般"并返回建议，不崩溃
```

---

### 文件操作不崩溃（10 分）

| 评分项 | 分数 | 评分标准 |
|-------|------|---------|
| 改进 load_learning_log | 3 分 | 使用 `try/except` |
| 捕获文件读取错误 | 3 分 | 捕获 `FileNotFoundError` 等异常 |
| 出错时给提示 | 2 分 | 提示"加载文件时出错"并创建新的数据文件 |
| 程序继续运行 | 2 分 | 文件加载失败后程序不崩溃，继续执行 |

**测试方法**：
```python
# 删除 pyhelper_data.txt，运行 PyHelper
预期行为：提示"首次运行，将创建新的数据文件"，程序正常运行

# 人为制造文件损坏（如写入乱码），运行 PyHelper
预期行为：捕获异常，提示"加载文件时出错"，程序继续运行
```

---

## 评分细则

### 代码正确性（40%）

- 能否正确处理各种异常情况（除以零、非数字输入、文件不存在等）
- 边界情况是否考虑（空输入、负数、超大数等）
- 程序是否在任何情况下都不会崩溃

---

### 防御性思维（30%）

- 是否考虑了各种可能的错误场景
- 是否用**重试**提升用户体验（而不是直接报错退出）
- 是否用**输入校验**防止错误发生

---

### 代码风格（20%）

- 是否遵循 PEP 8（变量命名、缩进、空行等）
- 是否用裸的 `except:` 掩盖问题（这是本周重点扣分项）
- 是否用 `raise` 而不是 `print` 上报错误

---

### 错误消息（10%）

- 是否清晰（告诉用户"出了什么错"）
- 是否具体（告诉用户"为什么出错"）
- 是否可操作（告诉用户"怎么修复"）

---

### 扣分项（最高扣 20 分）

| 问题 | 扣分 |
|------|------|
| 用裸的 `except:` 捕获所有异常 | -5 分/处 |
| 用 `print` 而不是 `raise` 上报错误 | -5 分/处 |
| 程序在某些输入下崩溃 | -3 分/处 |
- 错误消息不清晰或缺失 | -2 分/处 |
| 没有验证边界情况 | -2 分/处 |

---

## 总分计算

```python
总分 = 基础作业（40 分） + 进阶作业（30 分） + 挑战作业（20 分） + AI 练习（10 分）

# PyHelper 实践计入进阶作业，但单独评分（40 分）
# 如果 PyHelper 完成度高，可以额外加分（最高 10 分）
```

**评分等级**：
- **优秀（90-100 分）**：所有基础和进阶题正确，PyHelper 实现完善，代码风格优秀
- **良好（80-89 分）**：基础和进阶题基本正确，PyHelper 核心功能实现
- **合格（70-79 分）**：基础题正确，进阶题部分正确，PyHelper 部分实现
- **需改进（60-69 分）**：基础题大部分正确，进阶题未完成
- **不合格（< 60 分）**：基础题多处未完成或理解有误

---

## 评分检查清单

给 TA 的评分检查清单：

### 基础作业
- [ ] 题 1：除法器捕获了 `ValueError` 和 `ZeroDivisionError`
- [ ] 题 1：没有用裸的 `except:`
- [ ] 题 2：字典访问捕获了 `KeyError`
- [ ] 题 3：文件读取捕获了 `FileNotFoundError`
- [ ] 题 4：else/finally 理解正确

### 进阶作业
- [ ] 题 5：输入校验用 `while` 循环重试
- [ ] 题 5：用 LBYL 风格（`if` 检查）
- [ ] 题 6：用 `raise` 而不是 `print`
- [ ] 题 6：错误消息清晰

### 挑战作业（可选）
- [ ] 题 7：用 `for` 循环限制重试次数
- [ ] 题 8：用 EAFP 风格捕获异常

### PyHelper 实践
- [ ] 菜单选择不崩溃
- [ ] 日期输入不崩溃
- [ ] 心情选择不崩溃
- [ ] 文件操作不崩溃

### AI 练习（可选）
- [ ] 发现了至少 3 个问题
- [ ] 修复后的代码能通过测试
- [ ] 测试用例设计合理

---

**祝评分顺利！记住：本周的核心是"防御性编程"——不是防止用户犯错，而是假设用户一定会犯错，然后让程序能容错。**
