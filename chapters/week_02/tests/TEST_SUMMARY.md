# Week 02 测试设计总结

## 概览

- **总测试文件数**：4 个
- **总测试用例数**：150 个
- **测试通过率**：100% (150/150)
- **代码行数**：约 1500 行

## 测试文件结构

```
chapters/week_02/tests/
├── __init__.py                  # 包初始化文件
├── README.md                    # 测试文档（使用说明、运行命令）
├── test_smoke.py                # 基线测试（12 个测试）
├── test_conditionals.py         # 条件判断测试（30 个测试）
├── test_loops.py                # 循环测试（35 个测试）
└── test_booleans.py             # 布尔表达式测试（73 个测试）
```

## 测试覆盖矩阵

### 1. 条件判断（test_conditionals.py - 30 个测试）

| 测试类别 | 测试数量 | 覆盖内容 |
|---------|---------|---------|
| 单分支 if | 3 | 成年人判断、边界值（18 岁） |
| 多分支 if/elif/else | 8 | 分数评级（优秀/良好/及格/不及格） |
| 边界值测试 | 8 | 90/89/80/79/60/59/0/100 分 |
| 条件顺序性 | 1 | 从高到低 vs 从低到高 |
| 猜数字判断 | 3 | 正确/太小/太大 |
| 难度选择 | 5 | 简单/中等/困难/无效（参数化） |
| 嵌套条件 | 3 | 年龄+学生身份组合 |
| PyHelper 心情 | 4 | 充满干劲/一般般/有点累/无效 |

**关键边界测试**：
- 18 岁（成年/未成年边界）
- 60/80/90 分（评级边界）
- 0/99（无效难度）

### 2. 循环（test_loops.py - 35 个测试）

| 测试类别 | 测试数量 | 覆盖内容 |
|---------|---------|---------|
| range() 函数 | 8 | 基本用法、起点终点步长、倒序、空、单元素 |
| for 循环 | 7 | 求和、计数、break、continue、嵌套 |
| for...else | 4 | 正常结束 vs break 退出 |
| while 循环 | 5 | 倒计时、条件控制、break、continue、防止无限循环 |
| 猜数字循环 | 4 | 限制次数、剩余次数、提前成功、全部失败 |
| 循环应用 | 3 | 累加器、构建列表/字符串 |
| 循环边界 | 4 | 零次迭代、单次迭代、永不进入、只执行一次 |
| 实际应用 | 2 | 阶乘计算、FizzBuzz |

**关键边界测试**：
- `range(0)` - 零次迭代
- `range(1)` - 单次迭代
- `for...else` 的 else 执行条件
- while 循环的退出条件

### 3. 布尔表达式（test_booleans.py - 73 个测试）

| 测试类别 | 测试数量 | 覆盖内容 |
|---------|---------|---------|
| 比较运算符 | 12 | ==, !=, <, >, <=, >=（含参数化） |
| 逻辑运算符 - and | 6 | 两真、一假、两假、结合比较、短路 |
| 逻辑运算符 - or | 6 | 两真、一真、两假、结合比较、短路 |
| 逻辑运算符 - not | 3 | 取反、结合比较、复杂表达式 |
| 复杂表达式 | 8 | and/or 组合、难度验证、年龄优惠、用户名验证 |
| in / not in | 6 | 列表、字符串、难度验证 |
| 表达式简化 | 2 | 复杂 vs 命名变量、德摩根定律 |
| 真值判断 | 8 | 非零数字、零、非空字符串、空字符串、容器 |
| 实际应用 | 8 | 输入验证、游戏条件、密码强度、运算符优先级 |

**关键边界测试**：
- `0` vs `非零`（真值）
- `""` vs `"非空"`（字符串真值）
- `[]` vs `[元素]`（容器真值）
- 短路求值（and/or 的优化）
- 运算符优先级（and > or）

### 4. 基线测试（test_smoke.py - 12 个测试）

覆盖所有核心基础功能，确保 Python 环境正常工作。

## 测试设计亮点

### 1. 参数化测试（Parameterized Tests）

使用 `@pytest.mark.parametrize` 减少重复代码：

```python
@pytest.mark.parametrize("score, expected", [
    (90, "优秀"),   # 边界：正好 90
    (89, "良好"),   # 边界：89 是良好
    # ... 更多测试用例
])
def test_score_grade_boundaries(score, expected):
    # 一个测试函数，多种输入
```

### 2. 边界值测试

每个功能都测试边界情况：
- 比较运算符：测试等于、不等于、边界值
- 循环：测试 0 次、1 次、多次
- 条件：测试每个分支的边界

### 3. 清晰的命名

测试函数名采用 `test_<功能>_<场景>_<预期结果>` 格式：

```python
test_score_grade_excellent()        # 一看就知道测试什么
test_for_loop_with_break()          # 测试 for 循环的 break
test_guess_number_too_low()         # 测试猜数字"太小"的情况
```

测试失败时，函数名直接告诉你是哪里坏了。

### 4. 实际应用场景

测试不是抽象的语法验证，而是基于实际场景：
- 猜数字游戏的判断逻辑
- PyHelper 的心情推荐
- 用户输入验证
- 密码强度检查
- 优惠票价资格

### 5. 正例 + 边界 + 反例

每个功能都有三种测试：
- **正例**：正常输入应该通过
- **边界**：边界值（如 18 岁、60 分、0 次）
- **反例**：错误输入应该被拒绝（如无效难度、负数）

## 运行结果

```bash
$ python3 -m pytest chapters/week_02/tests -q
........................................................................ [ 48%]
........................................................................ [ 96%]
......                                                                   [100%]
150 passed in 0.14s
```

**测试通过率：100%**

## 与 Week 02 CHAPTER.md 的对应关系

| CHAPTER.md 章节 | 对应测试文件 | 测试数量 |
|----------------|------------|---------|
| 1. 如果这样，那就那样（if/elif/else） | test_conditionals.py | 30 |
| 2. 让它一直猜，直到猜中（while 循环） | test_loops.py（部分） | 15 |
| 3. 数到几就停（for 循环 + range） | test_loops.py（部分） | 20 |
| 4. 当条件变得复杂（布尔表达式） | test_booleans.py | 73 |
| 贯穿案例（猜数字游戏） | 跨多个文件 | 10+ |
| PyHelper 进度 | test_conditionals.py | 4 |

## 教学价值

这些测试不仅是验证工具，也是学习材料：

1. **示例代码**：每个测试都是一个可运行的小例子
2. **边界意识**：教会学生思考边界情况
3. **测试驱动**：展示如何为功能编写测试
4. **最佳实践**：展示清晰命名、参数化等技巧

## 下一步建议

1. **运行测试**：学生完成作业后运行测试验证
2. **阅读测试**：学生可以阅读测试代码来理解预期行为
3. **扩展测试**：鼓励学生为额外功能编写测试
4. **调试练习**：故意写错的代码，让学生通过测试发现 bug

## 总结

Week 02 的测试套件全面覆盖了条件判断、循环和布尔表达式的所有核心知识点。150 个测试用例确保了学生能够：

- ✅ 正确使用 if/elif/else 进行条件判断
- ✅ 理解条件的顺序性和边界值
- ✅ 熟练使用 for 和 while 循环
- ✅ 掌握 range() 函数的各种用法
- ✅ 理解 break 和 continue 的区别
- ✅ 正确编写和组合布尔表达式
- ✅ 理解短路求值和真值判断
- ✅ 应用逻辑运算符解决实际问题

这套测试为 Week 02 的学习提供了坚实的验证基础。
