# Week 14 评分标准：发布与部署——从"本地能跑"到"别人能用"

## 总分：100 分（基础 100 分 + 进阶 30 分）

---

## 评分维度

| 维度 | 分值 | 评分标准 | 验证方式 |
|------|------|---------|---------|
| **版本管理** | 20 | Git tag 规范，CHANGELOG 完整 | 检查标签 + CHANGELOG.md |
| **构建打包** | 25 | Maven 配置正确，JAR 可执行 | 检查 pom.xml + 运行测试 |
| **环境配置** | 25 | Config 类实现正确，支持多环境 | 检查配置文件 + Config.java |
| **部署验证** | 30 | 服务可访问，API 功能完整 | 访问 URL + 查看截图 |

---

## 详细评分标准

### 1. 版本管理（20 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 18-20 | 使用附注标签，版本号判断准确，CHANGELOG 结构完整（Added/Changed/Fixed 分类），有详细变更说明 |
| 良好 | 15-17 | 使用附注标签，版本号基本合理，CHANGELOG 完整 |
| 合格 | 12-14 | 有 Git tag，但可能使用轻量标签或版本号判断有偏差 |
| 不合格 | 0-11 | 没有 Git tag 或标签格式错误 |

**评分细则**：

| 项目 | 分值 | 检查要点 |
|------|------|---------|
| Git Tag 规范 | 5 | - [ ] 使用附注标签（`git tag -a`）而非轻量标签<br>- [ ] 标签名称符合 SemVer（如 v1.0.0）<br>- [ ] 标签信息包含发布说明 |
| 版本号判断 | 5 | - [ ] 根据功能完整性判断是否为 v1.0.0<br>- [ ] 理解 MAJOR/MINOR/PATCH 的区别<br>- [ ] 如果是 v0.x，有合理说明 |
| CHANGELOG 结构 | 5 | - [ ] 有版本号和发布日期<br>- [ ] 按 Added/Changed/Fixed 分类<br>- [ ] 变更描述清晰 |
| CHANGELOG 内容 | 5 | - [ ] 列出主要功能（任务 CRUD、API、持久化）<br>- [ ] 列出重要变更（如存储方式迁移）<br>- [ ] 列出修复的 bug |

**常见扣分项**：
- 使用轻量标签（-2 分）
- 版本号判断错误（如明显不完整却发布 v1.0.0）（-3 分）
- CHANGELOG 只有一行，没有分类（-3 分）
- 变更描述过于简单（如"新增功能"而不说明是什么功能）（-2 分）

---

### 2. 构建打包（25 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 22-25 | maven-shade-plugin 配置完整，JAR 可独立运行，主类正确，排除签名文件，有启动脚本 |
| 良好 | 18-21 | 配置正确，JAR 可运行，主类正确 |
| 合格 | 15-17 | 配置基本正确，但可能有 minor 问题 |
| 不合格 | 0-14 | 配置错误导致 JAR 无法运行 |

**评分细则**：

| 项目 | 分值 | 检查要点 |
|------|------|---------|
| maven-shade-plugin 配置 | 8 | - [ ] 插件版本正确（3.5.x）<br>- [ ] phase 设置为 package<br>- [ ] goal 设置为 shade |
| 主类配置 | 5 | - [ ] mainClass 正确（com.campusflow.Main）<br>- [ ] MANIFEST.MF 中有 Main-Class 条目<br>- [ ] 运行时不会报 "no main manifest attribute" |
| 签名文件排除 | 4 | - [ ] 有 filters 配置<br>- [ ] 排除 META-INF/*.SF、*.DSA、*.RSA<br>- [ ] 打包时不会报 "Signature already exists" |
| JAR 可执行性 | 8 | - [ ] JAR 包含所有依赖（大小合理，>10MB）<br>- [ ] 运行 `java -jar` 能正常启动<br>- [ ] 不需要额外依赖（如 Maven） |

**验证命令**：
```bash
# 检查 JAR 大小（包含依赖应该 >10MB）
ls -lh target/*.jar

# 检查 MANIFEST.MF
unzip -p target/*.jar META-INF/MANIFEST.MF | grep Main-Class

# 尝试运行
java -jar target/*.jar
```

**常见扣分项**：
- mainClass 配置错误（-5 分）
- 没有排除签名文件（-4 分）
- JAR 缺少依赖（运行时报 ClassNotFoundException）（-6 分）
- JAR 无法独立运行（需要 Maven）（-8 分）

---

### 3. 环境配置（25 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 22-25 | 配置文件结构合理，Config 类实现完整，支持环境变量切换，敏感信息处理正确 |
| 良好 | 18-21 | 配置文件完整，Config 类实现正确，支持环境切换 |
| 合格 | 15-17 | 配置基本完整，但可能有 minor 问题 |
| 不合格 | 0-14 | 配置缺失或实现错误 |

**评分细则**：

| 项目 | 分值 | 检查要点 |
|------|------|---------|
| 配置文件结构 | 7 | - [ ] 有 config-dev.properties 和 config-prod.properties<br>- [ ] 文件放在 src/main/resources 下<br>- [ ] 配置项合理（db.path、server.port、log.level） |
| Config 类实现 | 10 | - [ ] 从环境变量读取 CAMPUSFLOW_ENV<br>- [ ] 使用 ClassLoader 加载配置文件<br>- [ ] 有默认值处理（如 "dev"）<br>- [ ] 异常处理正确（文件不存在时抛出异常） |
| 环境变量支持 | 5 | - [ ] 支持 ${PORT:8080} 格式的占位符<br>- [ ] 能通过环境变量切换环境<br>- [ ] App.java 使用 Config 获取配置 |
| 敏感信息处理 | 3 | - [ ] 配置文件中没有硬编码密码/密钥<br>- [ ] 敏感信息用占位符表示<br>- [ ] 有安全意识说明 |

**安全检查**：
```bash
# 检查配置文件是否有敏感信息
grep -i "password\|secret\|key" src/main/resources/*.properties
```

**常见扣分项**：
- 配置文件路径错误（没放在 src/main/resources）（-3 分）
- Config 类实现错误（如硬编码环境）（-5 分）
- 不支持环境变量占位符（-3 分）
- 配置文件中有硬编码密码（-5 分，并要求修复）

---

### 4. 部署验证（30 分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 26-30 | 服务可访问，API 功能完整，部署文档清晰，截图完整 |
| 良好 | 21-25 | 服务可访问，API 基本功能正常，文档基本完整 |
| 合格 | 16-20 | 服务能访问，但可能有部分功能问题 |
| 不合格 | 0-15 | 无法访问或功能严重不完整 |

**评分细则**：

| 项目 | 分值 | 检查要点 |
|------|------|---------|
| 服务可访问性 | 10 | - [ ] 公网地址可访问<br>- [ ] 服务响应正常（无 502/503 错误）<br>- [ ] 访问速度合理（<5 秒加载） |
| API 功能完整性 | 10 | - [ ] GET /api/tasks 返回任务列表<br>- [ ] POST /api/tasks 能创建任务<br>- [ ] DELETE /api/tasks/{id} 能删除任务<br>- [ ] HTTP 状态码正确（200/201/404/500） |
| 部署文档 | 5 | - [ ] DEPLOYMENT.md 存在<br>- [ ] 包含平台选择理由<br>- [ ] 包含部署步骤<br>- [ ] 包含访问地址 |
| 截图验证 | 5 | - [ ] 功能验证截图（显示任务列表）<br>- [ ] Network 标签截图（显示 API 请求）<br>- [ ] 控制台截图（显示服务运行） |

**功能验证清单**：
```bash
# 测试 API 端点（替换为实际 URL）
curl https://your-app.up.railway.app/api/tasks
curl -X POST https://your-app.up.railway.app/api/tasks \
  -H "Content-Type: application/json" \
  -d '{"title":"Test Task","description":"Test"}'
```

**常见扣分项**：
- 服务无法访问（-10 分，要求重新部署）
- API 返回 500 错误（通常是数据库路径问题）（-5 分）
- 缺少截图或截图不清晰（-3 分）
- 部署文档过于简单（-2 分）

---

## 等级划分

| 等级 | 分数范围 | 描述 |
|------|---------|------|
| **A** | 90-100 | 版本管理规范，JAR 完美运行，环境配置完善，部署成功，文档清晰 |
| **B** | 80-89 | 版本管理基本规范，JAR 可运行，环境配置正确，部署成功 |
| **C** | 70-79 | 有版本标签，JAR 基本可运行，配置基本正确，部署基本成功 |
| **D** | 60-69 | 版本管理有问题，JAR 需要修改才能运行，配置不完整，部署有问题 |
| **F** | <60 | 未完成或严重不符合要求 |

---

## 进阶作业评分（+30 分）

### 进阶 1：Docker 容器化（+10 分）

| 项目 | 分值 | 评分标准 |
|------|------|---------|
| Dockerfile 质量 | 5 | 使用多阶段构建（3 分）+ 基础镜像安全（1 分）+ 配置正确（1 分） |
| 容器运行 | 3 | 能构建镜像（1 分）+ 能运行容器（1 分）+ 能访问服务（1 分） |
| 文档 | 2 | 有部署说明（1 分）+ 有验证截图（1 分） |

**检查要点**：
- [ ] 使用多阶段构建（减小镜像大小）
- [ ] 不使用 latest 标签（如 `FROM maven:latest`）
- [ ] 有 EXPOSE 指令
- [ ] 有 ENTRYPOINT 或 CMD
- [ ] 镜像大小合理（<300MB）

---

### 进阶 2：多环境部署（+10 分）

| 项目 | 分值 | 评分标准 |
|------|------|---------|
| 环境隔离 | 5 | 有开发和生产两个独立部署（各 2.5 分） |
| 配置差异 | 3 | 环境配置有明显差异（日志、CORS 等） |
| 自动部署 | 2 | 配置了 GitHub 分支自动部署 |

---

### 进阶 3：CI/CD 自动化（+10 分）

| 项目 | 分值 | 评分标准 |
|------|------|---------|
| GitHub Actions 配置 | 5 | 工作流配置正确（2 分）+ 能构建（2 分）+ 能测试（1 分） |
| 自动部署 | 5 | 配置了自动部署（5 分） |

**检查要点**：
- [ ] `.github/workflows/build.yml` 存在
- [ ] 工作流能触发（on push）
- [ ] 包含构建和测试步骤
- [ ] GitHub Actions 运行成功（有绿色勾）

---

## AI 使用日志评分（10 分，独立于作业总分）

| 等级 | 分值 | 标准 |
|------|------|------|
| 优秀 | 9-10 | 日志完整，有具体 Prompt，发现 3+ 个问题，有深入反思 |
| 良好 | 7-8 | 日志基本完整，有 Prompt，发现问题，有反思 |
| 合格 | 5-6 | 日志存在，但内容较简单 |
| 不合格 | 0-4 | 日志缺失或过于简单 |

**评分细则**：
- 使用的工具记录（1 分）
- AI 生成占比（1 分）
- Prompt 示例（2 分）
- 人工审查发现的问题（3 分，每个问题 1 分）
- 人工修改的部分（1 分）
- 学到的经验（2 分）

---

## 迟交政策

| 迟交时间 | 扣分 |
|---------|------|
| 24 小时内 | -10% |
| 48 小时内 | -20% |
| 超过 48 小时 | 按 0 分计 |

---

## 学术诚信

- **允许**：使用 AI 生成配置、让 AI 帮助调试、参考公开文档
- **禁止**：
  - 直接复制其他同学的配置
  - 伪造部署截图（URL 不匹配）
  - 使用别人已部署的服务

**部署验证**：我们会访问提交的 URL 验证功能。

---

## 评分检查清单（助教使用）

### 文件完整性检查
- [ ] CHANGELOG.md 存在且非空
- [ ] pom.xml 包含 maven-shade-plugin
- [ ] config-dev.properties 存在
- [ ] config-prod.properties 存在
- [ ] Config.java 存在
- [ ] DEPLOYMENT.md 存在
- [ ] AI_LOG.md 存在
- [ ] Git 标签截图
- [ ] JAR 文件或截图
- [ ] 部署截图（3 张）

### 版本管理验证
- [ ] Git tag 存在（`git tag -l`）
- [ ] 使用附注标签（`git tag -n9 v1.0.0`）
- [ ] CHANGELOG 结构完整
- [ ] 版本号符合 SemVer

### 构建打包验证
- [ ] pom.xml 有 maven-shade-plugin
- [ ] mainClass 配置正确
- [ ] 有签名文件过滤
- [ ] JAR 可运行（或截图证明）

### 环境配置验证
- [ ] 配置文件在正确路径
- [ ] Config 类实现正确
- [ ] 支持环境变量切换
- [ ] 无硬编码敏感信息

### 部署验证
- [ ] 公网地址可访问
- [ ] GET /api/tasks 正常
- [ ] POST /api/tasks 正常
- [ ] DELETE /api/tasks/{id} 正常
- [ ] 截图完整且清晰

---

## 反馈模板

### 优秀作业反馈示例
```
总分：95/100（A）

亮点：
- 版本管理非常规范，使用附注标签，CHANGELOG 结构完整
- Maven 配置完美，JAR 可独立运行，包含启动脚本
- 环境配置实现优雅，支持环境变量占位符，无敏感信息泄露
- 部署成功，API 功能完整，部署文档清晰，截图完整

建议：
- 可以考虑添加健康检查端点（如 GET /health）
- 进阶作业可以尝试配置 CI/CD 自动部署
```

### 需改进作业反馈示例
```
总分：65/100（D）

问题：
- 使用轻量标签而非附注标签（-3 分）
- JAR 报 "no main manifest attribute"，mainClass 配置错误（-8 分）
- 配置文件中硬编码了数据库密码（-5 分，安全隐患）
- 部署的 API 返回 500，数据库路径错误（-10 分）
- 缺少部分截图（-4 分）

改进建议：
1. 重新创建 Git 附注标签：`git tag -a v1.0.0 -m "..." -f`
2. 检查 pom.xml 中的 mainClass 配置
3. 将密码改为环境变量占位符：${DB_PASSWORD}
4. 修正 config-prod.properties 中的 db.path
5. 补充完整的部署验证截图
```

### 常见技术问题反馈

**问题 1：JAR 无法运行**
```
你的 JAR 报错 "no main manifest attribute"。检查：
1. pom.xml 中 <mainClass>com.campusflow.Main</mainClass> 是否正确
2. 重新运行 mvn clean package
3. 验证：unzip -p target/*.jar META-INF/MANIFEST.MF | grep Main-Class
```

**问题 2：部署后 API 500**
```
API 返回 500 通常是数据库路径问题。检查：
1. config-prod.properties 中的 db.path
2. 云平台是否提供持久化存储（Railway 提供 /data 目录）
3. 查看云平台日志确认错误信息
```

**问题 3：端口配置问题**
```
云平台分配的端口与应用监听的端口不一致。确保：
1. Config.java 支持环境变量 PORT
2. 使用 ${PORT:8080} 格式的占位符
3. 不要在代码中硬编码端口
```
