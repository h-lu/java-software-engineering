# Week 08 评分标准：代码重构与设计模式实践

## 评分维度

| 维度 | 权重 | 优秀 (90-100) | 良好 (75-89) | 合格 (60-74) | 不合格 (<60) |
|------|------|--------------|-------------|-------------|-------------|
| **代码质量** | 30% | 准确识别 5+ 种坏味道，重构手法应用得当，代码结构清晰，职责分明，圈复杂度显著降低 | 识别 4-5 种坏味道，重构手法基本正确，代码结构有改善 | 识别 2-3 种坏味道，重构手法使用基本正确，但仍有改进空间 | 坏味道识别不准确，重构手法使用错误，或代码结构未改善 |
| **设计模式应用** | 25% | 策略模式实现正确，符合开闭原则，易于扩展新策略；工厂模式使用得当 | 策略模式实现正确，基本符合开闭原则 | 策略模式实现基本正确，但扩展性有限 | 策略模式实现错误，或仍使用大量 if-else |
| **测试覆盖** | 20% | 重构前后都有测试保护，测试通过且覆盖边界情况；能识别 AI 生成代码的测试遗漏 | 有测试保护，测试通过，覆盖主要路径 | 有测试，但覆盖不足或缺少边界情况测试 | 缺少测试，或测试无法运行 |
| **ADR 质量** | 15% | ADR 结构完整，背景清晰，决策明确，后果分析诚实（含负面影响），替代方案分析有说服力 | ADR 结构完整，各部分内容合理 | ADR 基本完整，但某部分不够深入 | ADR 缺失或内容不完整 |
| **工程实践** | 10% | 使用静态分析工具，修复发现的问题；Git 提交规范（原子性提交，refactor: 前缀）；AI 审查深入 | 使用静态分析工具；Git 提交基本规范；完成 AI 审查 | 部分使用工具；Git 提交较规范 | 未使用工具，或 Git 提交混乱 |

---

## 详细评分项

### 1. 代码质量（30%）

**坏味道识别检查点**：
- [ ] 识别出上帝类（God Class）
- [ ] 识别出重复代码（Duplicated Code）
- [ ] 识别出长方法（Long Method）
- [ ] 识别出其他坏味道（如：紧耦合、过多参数、注释过多等）
- [ ] 对每种坏味道的危害分析准确

**重构手法检查点**：
- [ ] 正确应用提取方法（Extract Method）
- [ ] 正确应用移动方法（Move Method）
- [ ] 消除重复代码
- [ ] 方法职责单一，命名清晰
- [ ] 类之间依赖关系合理

**代码度量检查点**（进阶）：
- [ ] 重构前记录了圈复杂度
- [ ] 重构后圈复杂度降低（目标：方法圈复杂度 <= 10）
- [ ] 代码行数合理减少

**评分细则**：
- 90-100：识别 5+ 种坏味道，重构手法应用得当，圈复杂度显著降低
- 75-89：识别 4-5 种坏味道，重构手法基本正确
- 60-74：识别 2-3 种坏味道，重构有改进但不够彻底
- <60：坏味道识别不足，重构手法使用错误

---

### 2. 设计模式应用（25%）

**策略模式检查点**：
- [ ] 定义了策略接口（DiscountStrategy）
- [ ] 实现了具体策略类（VIP、优惠券、无折扣等）
- [ ] 策略类职责单一，互相独立
- [ ] 消除了原版的 if-else 链
- [ ] 新增策略时无需修改现有代码（符合开闭原则）

**工厂模式检查点**（进阶）：
- [ ] 使用工厂模式创建策略对象
- [ ] 客户端代码不直接实例化具体策略

**设计原则检查点**：
- [ ] 符合单一职责原则（SRP）
- [ ] 符合开闭原则（OCP）
- [ ] 符合依赖倒置原则（DIP）

**评分细则**：
- 90-100：策略模式实现完美，符合开闭原则，易于扩展，可能使用了工厂模式
- 75-89：策略模式实现正确，基本符合开闭原则
- 60-74：策略模式实现基本正确，但扩展性有限
- <60：策略模式实现错误，或仍使用大量 if-else

---

### 3. 测试覆盖（20%）

**测试保护检查点**：
- [ ] 重构前有测试保护（或编写了测试）
- [ ] 重构后所有测试通过
- [ ] 测试覆盖了主要功能路径
- [ ] 测试覆盖了边界情况（null、空列表、无效输入等）

**测试质量检查点**：
- [ ] 测试命名清晰（shouldXXXWhenYYY 格式）
- [ ] 断言精准，不只是 assertNotNull
- [ ] 测试独立于其他测试

**AI 审查检查点**（如完成 AI 协作练习）：
- [ ] 发现 AI 生成代码的测试遗漏
- [ ] 能指出 AI 代码的边界情况问题

**评分细则**：
- 90-100：重构前后都有测试保护，覆盖边界情况，能发现 AI 代码的测试问题
- 75-89：有测试保护，测试通过，覆盖主要路径
- 60-74：有测试，但覆盖不足
- <60：缺少测试，或测试无法运行

---

### 4. ADR 质量（15%）

**结构完整性检查点**：
- [ ] 包含标题和状态
- [ ] 包含背景（Context）
- [ ] 包含决策（Decision）
- [ ] 包含后果（Consequences）
- [ ] 包含替代方案（Alternatives）

**内容质量检查点**：
- [ ] 背景描述清晰，让读者理解为什么需要这个决策
- [ ] 决策明确，没有模棱两可的表述
- [ ] 后果分析包含正面和负面影响
- [ ] 替代方案分析有说服力，解释了为什么拒绝

**CampusFlow 关联检查点**：
- [ ] ADR 与 CampusFlow 项目相关
- [ ] 引用了实际的代码坏味道或技术债

**评分细则**：
- 90-100：ADR 结构完整，背景清晰，决策明确，后果分析诚实，替代方案有说服力
- 75-89：ADR 结构完整，各部分内容合理
- 60-74：ADR 基本完整，但某部分不够深入
- <60：ADR 缺失或内容不完整

---

### 5. 工程实践（10%）

**静态分析检查点**（进阶）：
- [ ] 配置了 SpotBugs 或 PMD
- [ ] 运行了静态分析
- [ ] 修复了发现的问题（至少 3 个）

**Git 实践检查点**：
- [ ] 重构提交原子性（每个手法单独提交）
- [ ] 提交信息规范（使用 refactor: 前缀）
- [ ] 提交信息描述清晰

**AI 协作检查点**（如完成）：
- [ ] 完成 AI 代码审查清单
- [ ] 发现至少 3 个问题或优点
- [ ] 有明确的决策（采纳/拒绝/部分采纳）
- [ ] 有合理的理由说明

**评分细则**：
- 90-100：使用静态分析工具，Git 提交规范，AI 审查深入
- 75-89：使用静态分析工具，Git 提交基本规范
- 60-74：部分使用工具，Git 提交较规范
- <60：未使用工具，或 Git 提交混乱

---

## 总分计算

| 等级 | 分数范围 | 说明 |
|------|----------|------|
| A | 90-100 | 优秀，所有维度表现突出 |
| B | 80-89 | 良好，少数方面可改进 |
| C | 70-79 | 合格，达到基本要求 |
| D | 60-69 | 及格，有明显不足 |
| F | <60 | 不合格，需要重做 |

---

## 常见扣分项

1. **测试无法运行**（-20 分）
   - 编译错误
   - 测试运行失败
   - 重构后测试未通过

2. **策略模式实现错误**（-15 分）
   - 仍使用大量 if-else
   - 策略类之间耦合
   - 不符合开闭原则

3. **坏味道识别不足**（-10 分）
   - 只识别出 1-2 种坏味道
   - 分析不深入

4. **ADR 缺失或不完整**（-15 分）
   - 缺少必要章节
   - 内容流于表面

5. **AI 输出未审查直接提交**（-10 分）
   - 直接复制 AI 生成的代码
   - 无审查清单或审查流于形式

6. **Git 提交不规范**（-5 分）
   - 提交信息不清晰
   - 所有改动混在一个提交里

---

## 加分项（最高 +10 分）

1. **圈复杂度降低 50% 以上**（+3 分）
2. **发现并修复 SpotBugs 高危问题**（+3 分）
3. **AI 审查发现关键设计缺陷**（+2 分）
4. **ADR 质量特别优秀，可作为团队模板**（+2 分）

---

## 提交检查清单（学生自测）

在提交前，请确认：

- [ ] 代码可以编译通过
- [ ] 所有测试通过（运行 `mvn test`）
- [ ] 识别了至少 5 种代码坏味道
- [ ] 应用了提取方法和移动方法重构
- [ ] 策略模式实现正确，消除了 if-else 链
- [ ] 编写了 ADR-004，结构完整
- [ ] CampusFlow 代码经过重构
- [ ] （进阶）配置了 SpotBugs/PMD 并运行
- [ ] （进阶）记录了圈复杂度对比
- [ ] （可选）完成 AI 协作练习
- [ ] 提交了所有要求的文档

---

## 教师评分备注

**快速评分流程**：
1. 克隆学生仓库
2. 运行 `mvn test`，确认所有测试通过
3. 检查代码坏味道分析报告
4. 检查策略模式实现
5. 检查 ADR-004
6. 检查静态分析报告（如提交）
7. 检查 AI 协作练习（如提交）

**参考命令**：
```bash
# 克隆并测试
git clone <student-repo-url>
cd <project-dir>
mvn test

# 静态分析
mvn spotbugs:check
mvn pmd:check

# 查看 SpotBugs 报告
open target/site/spotbugs.html
```

**重点检查项**：
- 策略模式是否正确应用（不是简单的把 if-else 换成 switch）
- 重构是否真正改善了代码结构（不只是拆分文件）
- ADR 是否诚实记录了负面影响
- AI 协作练习是否有深度思考（不是简单的好坏评价）
